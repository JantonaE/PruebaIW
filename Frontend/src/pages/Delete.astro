---
import Container from "@components/container.astro";
import Layout from "@layouts/Layout.astro";
import * as lib from "../lib/lib.ts";

const id = Astro.url.searchParams.get("id");

if (Astro.request.method == "POST") {
  try {
    const data = await Astro.request.formData();
    const idProd = data.get("idProd").toString();

    lib.deleteProduct(idProd);

    console.log("Finished");

    return Astro.redirect("/");
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
---


<Layout title={"Eliminar producto " + id}>
  <Container>
    <div class="flex flex-col items-center justify-center my-20">
      <h1>¿Estás seguro que quieres eliminar el producto con id: {id}?</h1>
      <form id="deleteProd" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="idProd" value={id} />
        <button
          id="deleteProd"
          type="submit"
          class="flex mt-5 items-center justify-center px-3 py-2 text-sm font-medium text-white bg-red-700 rounded-lg hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800">
          <span class="flex-1 whitespace-nowrap">Eliminar producto</span>
        </button>
        
      </form>
    </div>
  </Container>
</Layout>
