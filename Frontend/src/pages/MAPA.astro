---
import Map from "../components/Map.svelte";
import Layout from "../layouts/Layout.astro";
import type { ProductoOutput } from "../api";
import PublicarProd from "@components/modals/publicarProd.astro";
import FiltrosProd from "@components/FiltrosProd.astro";
import LoginButton from "@components/LoginButton.astro";
import * as lib from "@lib/lib";
import { getUser } from "@pages/auth/auth";

function convertirFormatoFecha(fechaString) {
  const [año, mes, dia] = fechaString.split("-");
  return `${dia}%2F${mes}%2F${año}`;
}



// Sustituir por el id del user conectado
//const userLogged = await lib.fetchUserByUserId("654fbef57e654dc35ca46cbe");
const userLogged = getUser();

const params = Astro.url.searchParams;
const data = await lib.filterProducts(
  params
);
---

<style>
  /* No poder scrolear con el modal */
  body.modal-open {
    overflow: hidden;
  }
</style>

<Layout title="Map">
  <PublicarProd />
  <FiltrosProd userLogged={userLogged} params={params} mapa={true}/>
  <script>
    const toggleModalBtn = document.getElementById("toggleModalBtn");
    const modal = document.getElementById("default-modal");

    toggleModalBtn.addEventListener("click", () => {
      modal.classList.toggle("hidden");
      modal.classList.toggle("flex");
      document.body.classList.toggle("modal-open"); // Agrega o elimina la clase 'modal-open'
    });

    const closeModalBtn = document.getElementById("closeModalBtn");
    closeModalBtn.addEventListener("click", () => {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      document.body.classList.remove("modal-open"); // Asegúrate de eliminar la clase 'modal-open' al cerrar el modal
    });
  </script>
  <Map prods={data} client:only />
</Layout>
